# 逻辑视图列表页优化方案（S0/S1/S3 + Run 机制）

日期：2026-01-17

## 目标
- 修正“理解完成 = 治理完成”的误导，建立统一的治理状态链路（S0/S1/S3）。
- 让批量语义理解具备明确的“Run”运行语义与可追踪性。
- 在列表层面直接呈现可治理的“待处理驱动视图”，支持排序/筛选。

## 范围
- 页面：逻辑视图列表页（列表 + 批量工具条 + 列表行展示）。
- 状态：表/字段/对象层级统一治理状态（列表需直接展示表级状态）。
- 规则：沿用现有语义理解规则与评分口径（不引入新规则）。

## 现状问题（必须明确）
1) 状态误导
- 现有“待理解/语义理解完成”将“生成建议”误当“治理完成”，缺失 Review/确认阶段。

2) 批量语义理解缺少 Run 语义
- “语义理解”按钮看起来像即时执行，但没有采样、规则版本、模型版本、队列、并发等关键信息。

3) 列表缺少治理驱动信息
- 无法在列表层直接识别“待Review字段/未通过/风险”规模，治理优先级缺失。

## 核心方案（定版）

### 1) 治理状态统一为三段（S0/S1/S3）
- S0 未理解
- S1 建议已生成（待Review）
- S3 已确认生效

列表“治理状态”列只显示以上三种状态，禁止出现“语义理解完成”。

### 2) Run 机制（批量语义理解必改）
批量动作改为“生成建议 Run”，点击后进入 Run 弹层。

Run 弹层内容：
- 采样行数（默认/可配置）
- 规则版本（Rule Version）
- 模型版本（Model Version）
- 预计耗时 / 并发队列 / 任务数
- 确认后生成 run_id

列表行展示：
- 本次 Run 状态：运行中 / 完成 / 失败
- 显示最近一次 run_id 与简要摘要（采样、版本、耗时）

### 3) 列表新增治理驱动列（可排序/筛选）
新增三列（或角标），用于直接判断治理优先级：
- 待Review字段数
- 门槛未通过数（Gate）
- 风险项数

列表提供排序与筛选：
- 只看待Review
- 只看 Gate 未通过
- 只看高风险

## 列表结构调整（命名一致性）
- 标题：逻辑视图列表
- 列名统一：逻辑视图名称 / 业务名称 / 所属数据源 / 行数 / 更新时间 / 治理状态
- 暂不显示“表/视图”类型

## 交互与文案

### 批量操作区
- 未勾选：按钮置灰，文案“批量生成建议（0）”
- 勾选后：文案“批量生成建议（N）”
- 提示行：预计耗时 2~3 分钟 · 采样 10k 行/表 · 队列 2/5
- info tooltip 说明：采样、版本、并发、队列含义

### 行级主操作
- S0：提示“未理解”
- S1：显示“进入Review”
- S3：才允许“生效/发布/生成对象”

## 指标口径（沿用现有规则）

### 待Review字段数
- 语义角色冲突（规则 vs AI）
- 置信度低于阈值
- 敏感等级为 L3/L4 且未确认

### 门槛未通过数（Gate）
- 表级 Gatekeeper 未通过
- 缺失主键 / 生命周期字段
- 命中排除表规则

### 风险项数
- 规则/AI融合分数低于阈值
- 敏感字段占比过高
- 冲突项数量超阈值

S0（未理解）时：以上三列显示“—”。

## Run 数据结构（建议落地方式）
采用“全局 Run 记录 + 表级快照摘要”混合方案：

全局 Run 记录（唯一事实源）：
- run_id, trigger_user, created_at
- sample_rows, rule_version, model_version
- queue_info, estimate_time
- status, error_reason

表级快照摘要（列表展示）：
- last_run_id, last_run_status, last_run_at
- last_run_summary（采样/版本/耗时）

## 验收要点
- 列表只显示 S0/S1/S3 状态
- 批量入口必须通过 Run 弹层
- 列表可按待Review/Gate/风险进行排序和筛选
- S1 与 S3 的操作权限与文案明确区分

