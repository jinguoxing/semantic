# 实施字段语义理解 v2.4

## 目标
在现有的逻辑视图详情页中实现“字段语义理解”作为一种新的工作模式，使用户能够在不离开表上下文的情况下审查和确定字段语义（角色、术语、标签）。

## 需要用户审查
无。基于用户提供的 `v2.4` 提示词和 Figma 规格实施。

## 建议变更

### 数据层
#### [修改] src/types/semantic.ts
- **TableSemanticStage**: 增加 `NOT_STARTED` (未开始), `FIELD_PENDING` (字段待确认), `MODELING_IN_PROGRESS` (建模进行中), `READY_FOR_OBJECT` (可进入对象建模)。
- **FieldStatus**: 增加 `UNANALYZED` (未分析), `SUGGESTED` (有建议), `DECIDED` (已确认), `BLOCKED` (阻塞)。
- **FieldItem**: 增加 `semanticStatus: FieldStatus`, `riskLevel: 'LOW' | 'MEDIUM' | 'HIGH'`, `role?: string`, `term?: string`, `tags?: string[]`。

#### [修改] src/data/mockData.ts
- 更新模拟 `scanResults` 以包含新的字段语义状态和表阶段。

### 组件逻辑

#### [修改] src/views/DataSemanticUnderstandingView.tsx
- **状态管理**: 增加 `detailMode: 'BROWSE' | 'SEMANTIC'`。
- **列表视图**:
  - 更新 `columns` 以显示“治理阶段” (`TableSemanticStage`)。
  - 每行增加“主行动 CTA”（开始/继续/查看）。
  - 点击 CTA：执行 `setViewMode('detail')` 并设置对应的 `detailMode`。
- **详情视图**:
  - 实现 **双模式布局**:
    - **浏览模式 (Browse Mode)**: 现有布局 (Tab 页结构)。
    - **语义模式 (Semantic Mode)**: 三栏布局 (左侧：治理列表, 中间：上下文, 右侧：裁决面板)。
  - 将 `activeMode` 状态传递给子组件。

#### [新增] src/views/semantic/components/GovernanceFieldList.tsx
- 从 View 中提取字段列表渲染逻辑。
- 支持“治理模式”，显示语义状态图标 (`CheckCircle`, `AlertCircle`) 和风险/置信度标记。

#### [新增] src/views/semantic/components/SemanticDecisionPanel.tsx
- **输入区域**: 字段角色 Role (单选, 枚举: Identifier, ForeignKey, Status, Time, Measure, Attribute, Audit, Technical), 业务含义 Term (选择), 语义标签 Tags (多选)。
- **建议证据**: 显示 `field.suggestion` 中提供的规则证据或 AI 解释。
- **操作按钮**: 接受建议 (Accept), 修改确认 (Modify), 拒绝 (Reject, 需填原因)。

#### [新增] src/views/semantic/FieldSemanticWorkbench.tsx (可选/后续)
- 对应 Prompt 中的“字段语义理解工作台”。
- 功能：跨表治理调度，展示所有未决字段。
- 定位：如果 `DataSemanticUnderstandingView` 的列表模式已经足够作为调度台，此页面可作为后续增强；但在 MVP 中，我们确保逻辑视图列表页具备“调度台”属性。根据 Prompt 要求，这是一个“新增页面，但极简”。我们将对其进行基础实现。

#### [修改] src/views/semantic/components/SemanticHeader.tsx
- 增加 `mode` 属性支持模式显示。
- 在 `SEMANTIC` 模式下渲染“语义进度条” (已确认数 / 总字段数)。

## 验证计划

### 手动验证
1.  **列表视图导航**:
    - 验证“主行动按钮 (CTA)”文案是否根据表阶段变化（开始/继续/查看）。
    - 点击“开始字段语义理解” -> 应以“语义理解模式”打开详情页。
2.  **语义模式布局**:
    - 验证详情页是否呈现“左中右”三栏布局。
    - 检查头部 Header 是否显示进度条。
3.  **裁决交互**:
    - 在左侧列表切换字段 -> 中间上下文跟随更新 -> 右侧面板显示当前字段的裁决状态。
    - 验证 Role 枚举值是否正确 (Identifier, ForeignKey 等)。
    - 操作裁决面板（修改角色/术语） -> 点击确认 -> 左侧列表对应字段状态更新为“已确认”。
4.  **工作台 (如实现)**:
    - 验证跨表字段列表展示及定位跳转功能。
5.  **模式切换**:
    - 在详情页内部切换“浏览模式”与“语义理解模式”，验证布局平滑过渡且上下文不丢失。
