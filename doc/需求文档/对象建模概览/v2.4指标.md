
# 0. 总体 API 约定

## 0.1 统一请求参数

* `tenantId`
* `projectId`
* `timeRange`：`LAST_7_DAYS | LAST_30_DAYS | LAST_90_DAYS`
* 可选：`domainId`（如果你们有领域/业务域）

## 0.2 统一返回约定

* 数值字段尽量返回 **count/int**
* 比例返回 **rate（0~1）+ displayPercent（0~100 可选）**
* 提供 drill-down 跳转所需的 **filterHint**（前端拼查询条件）

---

# 1. 概览页聚合接口（建议 1 个接口打满）

> 推荐一个接口返回全页数据，避免前端发 10 个请求。

## API：`GET /api/v2/semantic-modeling/overview`

### Response Schema（建议）

```json
{
  "meta": {
    "tenantId": "t1",
    "projectId": "p1",
    "timeRange": "LAST_30_DAYS",
    "generatedAt": "2026-01-18T10:00:00Z"
  },
  "kpis": { },
  "views": { },
  "stages": { },
  "blockers": [ ],
  "nextActions": [ ]
}
```

---

# 2. 指标 → 字段映射表（核心）

下面每一项都给出：

* **UI 指标**
* **后端返回字段**
* **来源表/逻辑（你们已有 run/suggestion/decision/version）**
* **drill-down 跳转 filterHint**

---

## 2.1 顶部 KPI 区（4 张卡）

---

### KPI-01 业务对象规模（对象总数、已发布/草稿/归档）

**UI**

* `对象规模`：9
* `已发布 8 / 草稿 1 / 归档 0`

**API 字段**

```json
"kpis": {
  "objectScale": {
    "total": 9,
    "published": 8,
    "draft": 1,
    "archived": 0,
    "trend": {
      "points": [{"ts":"2026-01-01","value":7},{"ts":"2026-01-18","value":9}]
    },
    "filterHint": {
      "route": "/semantic-modeling/objects",
      "query": { "status": ["PUBLISHED","DRAFT","ARCHIVED"] }
    }
  }
}
```

**数据来源/计算**

* `business_object`（或你们对象建模实体表）

  * `status in (PUBLISHED,DRAFT,ARCHIVED)`
* `total = published + draft + archived`

---

### KPI-02 候选与审核（候选对象待确认/已确认/已忽略）

**API 字段**

```json
"kpis": {
  "candidateReview": {
    "total": 4,
    "pending": 3,
    "confirmed": 0,
    "ignored": 1,
    "pendingRate": 0.75,
    "filterHint": {
      "route": "/semantic-modeling/candidates",
      "query": { "status": ["PENDING","CONFIRMED","IGNORED"] }
    }
  }
}
```

**数据来源/计算**

* `candidate_business_object`

  * `status: PENDING | CONFIRMED | IGNORED`

> 注：CONFIRMED 不等于 PUBLISHED，只代表“候选已裁决进入建模”。

---

### KPI-03 建模冲突与风险（严重/警告/提示，仅语义层）

**API 字段**

```json
"kpis": {
  "modelingConflict": {
    "total": 5,
    "severity": { "critical": 2, "warning": 2, "info": 1 },
    "trend": { "points": [{"ts":"2026-01-01","value":3},{"ts":"2026-01-18","value":5}] },
    "filterHint": {
      "route": "/field-semantic/review",
      "query": { "hasConflict": true }
    }
  }
}
```

**数据来源/计算（建议统一冲突表）**

* 你们可以落一张：`semantic_issue`（推荐）

  * `issue_domain = SEMANTIC_MODELING`
  * `issue_type`：TERM_CONFLICT / ROLE_CONFLICT / NAME_COLLISION / KEY_FIELD_MISSING…
  * `severity`：CRITICAL/WARNING/INFO
* `total = count(issue_id where open=true)`

> 如果暂时没有 issue 表，可先从 decision 的冲突标记聚合：
> `semantic_decision.conflict_flag=true` 按 severity 聚合。

---

### KPI-04 语义建模成熟度（限定版）

**API 字段**

```json
"kpis": {
  "modelingMaturity": {
    "score": 33,
    "components": {
      "keyFieldCompletionRate": 0.56,
      "objectTypeDefinedRate": 0.67,
      "conflictResolvedRate": 0.89
    },
    "trendLabel": "近7日趋势稳定"
  }
}
```

**计算建议（可配置）**

* `score = round( w1*keyFieldCompletionRate + w2*objectTypeDefinedRate + w3*conflictResolvedRate , 0~100 )`
* 权重建议：`w1=0.4, w2=0.3, w3=0.3`

**来源映射**

* `keyFieldCompletionRate`：来自字段语义决策完成率（见 2.2）
* `objectTypeDefinedRate`：表语义/对象类型是否已裁决（semantic_table_fact 或 table_decision）
* `conflictResolvedRate`：semantic_issue resolved / total

---

## 2.2 视角区：业务视角 / 技术视角（摘要指标）

> 这块你之前页面里有“目标覆盖、KPI口径、资产接入、映射进度”。
> 在语义建模概览里可以保留，但只当“建模推进条件”显示。

---

### BV-01 业务目标覆盖

**API 字段**

```json
"views": {
  "business": {
    "goalCoverage": {
      "rate": 0.56,
      "totalGoals": 3,
      "planned": 1,
      "modeled": 1,
      "landed": 1,
      "filterHint": { "route": "/business-modeling/goals", "query": { } }
    }
  }
}
```

**来源**

* `business_goal`（或业务梳理模块表）

  * 状态：PLANNED/MODELED/LANDED

**口径**

* `rate = (modeled + landed) / totalGoals`（可按你们定义调整）

---

### BV-02 KPI 口径覆盖 / 一致率

**API 字段**

```json
"views": {
  "business": {
    "kpiCoverage": {
      "covered": 4,
      "total": 6,
      "consistencyRate": 0.67,
      "filterHint": { "route": "/business-modeling/kpi", "query": { } }
    }
  }
}
```

**来源**

* `kpi_definition` / `kpi_metric`
* `consistencyRate` 需要你们定义一致性规则（同名/同口径映射等），可先用：

  * `consistentCount / total`

---

### TV-01 资产接入（仅作为“可建模前置条件”摘要）

**API 字段**

```json
"views": {
  "tech": {
    "assetIngestion": {
      "connected": 5,
      "total": 7,
      "scanning": 1,
      "error": 1,
      "filterHint": { "route": "/data-sources", "query": { } }
    }
  }
}
```

**来源**

* `datasource` + `scan_job`（或你们已有接入/扫描任务表）

---

### TV-02 表→对象映射进度（只显示覆盖，不谈质量）

**API 字段**

```json
"views": {
  "tech": {
    "mappingProgress": {
      "mapped": 8,
      "total": 9,
      "missingObjects": ["Inventory"],
      "filterHint": { "route": "/mapping/workbench", "query": { "status": ["MISSING","PARTIAL"] } }
    }
  }
}
```

**来源**

* `object_mapping`（对象属性 ↔ 字段映射）
* `mapped`：已存在有效映射的对象数
* `missingObjects`：无映射或映射不足的对象

---

## 2.3 对象态势

### OH-01 关键对象热度 TOP N

**API 字段**

```json
"stages": {
  "objectHeatTopN": {
    "items": [
      { "objectId":"o1", "name":"供应商", "heatScore": 98 },
      { "objectId":"o2", "name":"采购订单", "heatScore": 85 }
    ],
    "filterHint": { "route": "/semantic-modeling/objects", "query": { "sort": "HEAT_DESC" } }
  }
}
```

**热度计算建议**

* `heatScore = a*goalRefCount + b*kpiRefCount + c*mappedFieldCount + d*recentActivity`
* recentActivity：近 timeRange 内的建模变更/访问/引用次数

---

## 2.4 建模阶段进展（流程态）

### ST-01 阶段状态（业务梳理/字段语义/候选对象/对象建模）

**API 字段**

```json
"stages": {
  "pipeline": [
    { "key": "BUSINESS_MODELING", "label": "业务梳理", "status": "DONE" },
    { "key": "FIELD_SEMANTIC", "label": "字段语义理解", "status": "IN_PROGRESS", "progress": 0.6 },
    { "key": "CANDIDATE_OBJECT", "label": "候选业务对象", "status": "BLOCKED", "blockerCount": 3 },
    { "key": "OBJECT_MODELING", "label": "业务对象建模", "status": "NOT_STARTED" }
  ]
}
```

**状态判定口径（推荐）**

* BUSINESS_MODELING：

  * DONE：目标+KPI 基本定义完成（covered/total 超阈值）
* FIELD_SEMANTIC：

  * progress = `decidedKeyFields / totalKeyFields`（或 decidedFields/totalFields）
* CANDIDATE_OBJECT：

  * BLOCKED：`pendingCandidates > 0`
* OBJECT_MODELING：

  * IN_PROGRESS：存在 draft 对象且未发布
  * DONE：关键对象已发布（按策略定义）

---

## 2.5 阻塞项（可点击定位）

### BL-01 建模阻塞列表

**API 字段**

```json
"blockers": [
  {
    "type": "GOAL_NOT_BOUND",
    "label": "未绑定业务目标",
    "count": 2,
    "severity": "CRITICAL",
    "filterHint": { "route": "/business-modeling/goals", "query": { "status": ["UNBOUND"] } }
  },
  {
    "type": "KEY_FIELD_UNDECIDED",
    "label": "关键字段语义未确认",
    "count": 12,
    "severity": "CRITICAL",
    "filterHint": { "route": "/field-semantic/review", "query": { "isKeyField": true, "status": ["PENDING"] } }
  }
]
```

**来源**

* 强烈建议统一落表：`semantic_issue`（同 2.1 KPI-03）
* blockers = open issues where severity >= threshold

---

## 2.6 下一步行动（动态 CTA）

### NA-01 CTA 列表

**API 字段**

```json
"nextActions": [
  {
    "key": "GO_FIELD_SEMANTIC",
    "label": "去字段语义理解",
    "priority": 1,
    "highlight": true,
    "route": "/field-semantic/review",
    "query": { "status": ["PENDING"] }
  },
  {
    "key": "GO_CANDIDATES",
    "label": "去候选业务对象",
    "priority": 2,
    "highlight": false,
    "route": "/semantic-modeling/candidates",
    "query": { "status": ["PENDING"] }
  }
]
```

**生成规则（建议）**

* 若存在 CRITICAL blocker → highlight 对应处理入口
* 否则 highlight 当前 pipeline 的 IN_PROGRESS 阶段入口

---

# 3. 需要后端补齐的“聚合视图 / 物化表”（避免实时扫大表）

为保证性能，建议至少准备 2 个聚合视图：

1. `semantic_modeling_metrics_daily`

* 按天存：对象数、候选数、冲突数、成熟度 components
* 支持趋势 sparkline

2. `semantic_issue`（统一问题表）

* 语义冲突、关键字段未确认、命名不合规等都进来
* 支持 severity、domain、scope（field/table/object）

---

# 4. 如果你希望拆多接口（备选）

如果你们更偏微服务/权限隔离，可拆为：

* `GET /semantic-modeling/overview/kpis`
* `GET /semantic-modeling/overview/views`
* `GET /semantic-modeling/overview/stages`
* `GET /semantic-modeling/overview/blockers`
* `GET /semantic-modeling/overview/next-actions`

但我仍建议先做单接口，前端体验更稳。

---

# 5. 最终交付清单（你可以直接发给研发）

1. 新增接口：`GET /api/v2/semantic-modeling/overview`
2. 返回字段按本映射表实现
3. 缺失能力补齐：

   * `semantic_issue` 统一问题模型（强烈建议）
   * `semantic_modeling_metrics_daily` 趋势聚合表（建议）

---
