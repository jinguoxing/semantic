# BizSemantic v2.4

## 语义理解辅助检测（Semantic Assist）统一工程规范

---

## 0. 统一概念声明（必须写在最前）

> **语义理解辅助检测（Semantic Assist）**
> 是语义理解阶段的辅助能力，
> 通过模板化信号（SEMANTIC_MIN）为语义建议提供证据与风险提示。
>
> 该能力：
>
> * 不等同于数据质量检测
> * 不产生通过 / 失败结论
> * 不影响语义裁决与语义版本生效
> * 所有配置均为“运行参数”，不是治理策略

---

## 1. 核心抽象（统一给大模型）

### 1.1 核心对象：SemanticAssist

```ts
SemanticAssist {
  enabled: boolean
  template: "SEMANTIC_MIN"
  runtimeConfig: {
    sampleRatio: number
    forceRecompute?: boolean
  }
  systemConfig: {
    maxRows: number
    ttlHours: number
  }
  scope: "TABLE" | "BATCH"
  sourceInfo?: {
    fromQuality: boolean
    fromSemanticProfile: boolean
    lastComputedAt?: string
  }
}
```

> ⚠️ 说明
>
> * `template` 在 v2.4 **固定不可编辑**
> * `runtimeConfig` 是唯一允许用户调整的部分
> * `systemConfig` 只读展示

---

## 2. 三个 UI 的统一定位（必须严格区分）

| UI 场景    | 定位                | 是否可修改  |
| -------- | ----------------- | ------ |
| 详情页辅助检测条 | **表级运行状态 + 快速控制** | ✔ 运行参数 |
| 批量语义理解弹窗 | **批量 Run 的参数快照**  | ✔ 运行参数 |
| 模板说明抽屉   | **模板能力解释**        | ❌ 不可修改 |

👉 **三者共用同一套数据结构，不允许分叉实现**

---

## 3. 统一组件拆分（前端必须这样拆）

### 3.1 抽象组件清单（必须）

```text
SemanticAssistBar          // 详情页顶部
SemanticAssistConfigPanel  // 设置面板（详情页 & 批量共用）
SemanticAssistBatchModal   // 批量语义理解弹窗
SemanticAssistTemplateInfo // 模板说明抽屉
```

---

## 4. 详情页（TABLE Scope）规范

### 4.1 SemanticAssistBar（详情页顶部）

**Props（统一定义）**

```ts
SemanticAssistBarProps {
  assist: SemanticAssist
  onToggle(enabled: boolean)
  onOpenConfig()
  onOpenTemplateInfo()
  onRefresh()
}
```

**行为规则（给大模型）**

* toggle 仅影响当前表
* refresh 触发 profile run（不阻塞语义理解）
* 点击模板 → 打开 TemplateInfo（只读）

---

### 4.2 SemanticAssistConfigPanel（详情页设置）

**Props**

```ts
SemanticAssistConfigPanelProps {
  assist: SemanticAssist
  onApply(runtimeConfig)
}
```

**约束**

* 不允许编辑 template
* 不允许编辑 maxRows / ttl
* 只允许：

  * sampleRatio
  * forceRecompute（可选）

**Apply 语义**

* 仅应用到当前表
* 不影响批量任务
* 不影响系统默认

---

## 5. 批量语义理解弹窗（BATCH Scope）

### 5.1 SemanticAssistBatchModal

**Props**

```ts
SemanticAssistBatchModalProps {
  selectedTables: string[]
  defaultAssist: SemanticAssist
  onStart(batchRunConfig)
}
```

### 5.2 Batch Run Config（后端快照）

```json
{
  "runType": "SEMANTIC_SUGGESTION_BATCH",
  "scope": "BATCH",
  "targets": [...],
  "semanticAssist": {
    "enabled": true,
    "template": "SEMANTIC_MIN",
    "runtimeConfig": {
      "sampleRatio": 0.01,
      "forceRecompute": false
    }
  }
}
```

**关键规则**

* 批量配置 ≠ 详情页配置
* 必须作为 run snapshot 保存
* 后续详情页展示“来源于某次批量任务”

---

## 6. 模板说明抽屉（Template Info）

### 6.1 SemanticAssistTemplateInfo

**Props**

```ts
SemanticAssistTemplateInfoProps {
  template: "SEMANTIC_MIN"
}
```

### 6.2 内容规范（只读）

* 模板定位说明
* 包含的**信号维度**（不是规则）
* 风险提示机制说明
* 明确声明：

  * 不可编辑
  * 不配置阈值
  * 不影响质量模块

**禁止行为**

* ❌ 不允许任何配置项
* ❌ 不出现“规则 / 校验 / 通过失败”

---

## 7. 与质量检测的统一关系（必须写给大模型）

### 7.1 信号来源策略

```text
if (recentQualityResult exists && covers required signals):
    reuse quality signals
else:
    run semantic profile (SEMANTIC_MIN)
```

### 7.2 UI 展示（统一）

```text
信号来源：
✓ 已复用质量检测结果
✓ 已补充语义辅助采样（1%）
```

---

## 8. 状态机（统一）

```text
IDLE
 └─ RUNNING
     ├─ SUCCESS
     └─ ERROR
```

* ERROR 不阻塞语义理解
* SUCCESS 更新 sourceInfo

---

## 9. 禁止事项（Hard Rules）

大模型 **必须遵守**：

* ❌ 不把 SemanticAssist 当成质量检测
* ❌ 不输出 Pass / Fail
* ❌ 不允许配置模板内容
* ❌ 不影响语义裁决逻辑
* ❌ 不影响语义版本 Gate

---

## 10. 一句话总结（可以作为 Prompt 结尾）

> **Semantic Assist 是语义理解阶段的统一辅助能力，
> 在详情页、批量任务与模板说明中共用同一套数据模型与组件，
> 仅提供证据与风险提示，不参与治理决策。**

---

## 你现在可以直接这样用

你可以把上面内容直接作为：

* 👉 **System Prompt / Developer Prompt**
* 👉 **前端代码生成任务说明**
* 👉 **前后端联调契约文档**

---
