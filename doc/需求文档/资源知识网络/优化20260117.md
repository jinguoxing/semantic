
# 一、整体目标（给大模型的系统级指令）

```text
你是一个企业级「数据语义治理平台」的工程实现模型。
目标是基于既有的资源知识网络（Knowledge Graph），
完成一次工程化整改，使其：

1. 明确区分 Top-down / Bottom-up 的语义来源
2. 强制引入 Semantic Version 作为唯一事实源（SoT）
3. 让知识网络可稳定支撑「智能问数（可执行查询）」
4. 保证 AI 只能产生 Suggestion，不能直接生效
```

---

# 二、核心整改点 → 工程化需求拆解（总览）

```text
整改主题
├── A. 版本与状态机（Version as SoT）
├── B. Draft / Version / Effective 的工程隔离
├── C. 业务对象 ↔ 数据字段 Mapping 建模
├── D. 关系（Edge）的工程语义补全
├── E. Knowledge Graph 的双模式（Explore / Build）
├── F. 问数所需的最小语义协议（Metric / Time / Grain）
```

下面我会**逐条给出：**

* 工程目标
* 必须新增的数据结构
* 可直接给 LLM 的 Prompt 模板

---

# A. 语义版本（Semantic Version）工程化

## A.1 工程目标

```text
- 系统中必须存在明确的 SemanticVersion 实体
- 所有 Knowledge Graph 都必须绑定到某一个 SemanticVersion
- 问数、AI、服务只能读取 EFFECTIVE 状态的版本
```

---

## A.2 必须实现的数据结构（示例）

```json
SemanticVersion {
  id: string
  name: string
  status: enum[DRAFT, CANDIDATE, EFFECTIVE, DEPRECATED]
  based_on_version?: string
  created_by: string
  created_at: timestamp
  description?: string
}
```

---

## A.3 可直接喂给大模型的 Prompt

```text
请为一个数据语义治理平台设计 SemanticVersion 的后端模型、
状态机与接口约束。

要求：
1. 必须支持 DRAFT → CANDIDATE → EFFECTIVE → DEPRECATED
2. EFFECTIVE 版本只读，不可被修改
3. KnowledgeGraph 只能从 EFFECTIVE 版本构建
4. 所有语义对象、关系、映射都必须关联 version_id
```

---

# B. Draft / Version / Effective 的工程隔离

## B.1 工程目标

```text
- Top-down 与 Bottom-up 产生的结果只能写入 Draft
- 人工裁决后才能生成 Version Snapshot
- Explore 模式只能访问 Version Snapshot
```

---

## B.2 状态机模型（强约束）

```text
SemanticObjectState:
  DRAFT
  DECIDED
  EFFECTIVE (via SemanticVersion)
```

---

## B.3 LLM Prompt（状态机）

```text
请设计一个语义对象（SemanticObject）的状态机，
用于支持 Draft / Decision / Versioned 的治理流程。

约束：
- AI 只能生成 DRAFT 状态对象
- 人工操作才能进入 DECIDED
- 只有 SemanticVersion 发布时才进入 EFFECTIVE
```

---

# C. 业务对象 ↔ 数据字段 Mapping（问数核心）

## C.1 工程目标（非常关键）

```text
- 明确区分：
  - BusinessObject.Attribute（业务属性）
  - DataField（物理字段）
- Mapping 是一等公民
- 问数必须通过 Mapping 找到字段与 Join 路径
```

---

## C.2 Mapping 数据模型（示例）

```json
AttributeFieldMapping {
  id: string
  version_id: string
  business_object_id: string
  attribute_id: string
  table_name: string
  field_name: string
  join_key?: string
  confidence: number
  source: enum[TOP_DOWN, BOTTOM_UP, MANUAL]
}
```

---

## C.3 LLM Prompt（Mapping）

```text
请为一个语义治理平台设计“业务属性 ↔ 数据字段”的 Mapping 模型。

要求：
1. Mapping 必须绑定到 SemanticVersion
2. 支持一个属性映射多个字段（如多源）
3. 支持记录来源（Top-down / Bottom-up / 人工）
4. 能被问数引擎用于生成 Join 与 Select
```

---

# D. 关系（Edge）的工程语义补全

## D.1 工程目标

```text
- 关系不只是中文描述
- 必须具备机器可解释的语义
- 能支撑 Join、路径搜索、反向关系
```

---

## D.2 关系模型（Edge）

```json
SemanticRelation {
  id: string
  version_id: string
  source_object_id: string
  target_object_id: string
  predicate_id: string
  display_name: string
  inverse_display_name?: string
  cardinality: enum[ONE_ONE, ONE_MANY, MANY_MANY]
  join_hint?: {
    source_field: string
    target_field: string
  }
}
```

---

## D.3 LLM Prompt（关系建模）

```text
请设计资源知识网络中“关系（Edge）”的数据模型。

要求：
1. 区分 display_name 与 predicate_id
2. 支持基数（1-1 / 1-N / N-N）
3. 支持反向关系名称
4. 可选 Join Hint 用于 SQL 生成
```

---

# E. Knowledge Graph 的双模式（Explore / Build）

## E.1 工程目标

```text
- Explore 模式：只读、面向理解与问数
- Build 模式：可编辑、写入 Draft
- 两种模式共享同一 Graph 结构
```

---

## E.2 模式控制规则

```text
if mode == EXPLORE:
  deny write
  version must be EFFECTIVE

if mode == BUILD:
  allow write
  target version must be DRAFT
```

---

## E.3 LLM Prompt（前端/权限）

```text
请设计资源知识网络页面的双模式机制（Explore / Build）。

要求：
1. Explore 模式只读，只能选择 EFFECTIVE 版本
2. Build 模式可编辑，只能写入 DRAFT
3. 同一图结构，切换模式不丢状态
```

---

# F. 问数所需的最小语义协议（Query-Ready）

## F.1 工程目标

```text
- Knowledge Graph 必须为问数提供：
  - Metric（指标）
  - Dimension（维度）
  - Time（时间）
  - Grain（粒度）
```

---

## F.2 Metric 模型（最小）

```json
Metric {
  id: string
  version_id: string
  name: string
  expression: string
  grain: string
  time_field: string
  base_object_id: string
}
```

---

## F.3 LLM Prompt（问数语义）

```text
请设计一个支持智能问数的最小语义协议。

要求：
1. Metric / Dimension / Time / Grain 明确区分
2. 所有元素都能从 Knowledge Graph 中定位
3. 能生成可执行 SQL 或 Service Call
```

---

# 三、给大模型的“总控 Prompt”（强烈建议）

你可以把下面这段作为 **System Prompt**：

```text
你正在实现一个企业级数据语义治理平台。
所有语义必须是：
- 版本化的
- 可追溯的
- AI 不可直接生效的

请基于以下约束生成工程实现：
1. 支持 Top-down 与 Bottom-up 双路径
2. 统一收敛到 SemanticVersion
3. Knowledge Graph 只表达 Version 中的事实
4. 问数必须可从 Graph 推导出可执行查询
```

---

# 四、你现在这个整改方案的工程成熟度判断

如果你按这套工程化需求推进：

* **研发能落地**（模型清晰、状态机明确）
* **大模型能理解并生成正确代码**
* **问数有清晰、可执行的语义基础**
* **未来引入 Agent 不会推翻架构**

---


