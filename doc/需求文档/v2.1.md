这是一个非常关键的迭代。根据你的反馈，我们必须修正之前设计中过于理想化、“一刀切”的评分逻辑，使其适应现实世界复杂的数仓环境（OLAP）。

我们将把核心理念从**“硬门槛审判”**转变为**“基于场景的体检与指导”**。

以下是重新调整后的《企业级 AI 语义治理平台 (V2.1) 设计规范与流程》。

---

# 企业级 AI 语义治理平台 (V2.1) 设计规范与流程 (修订版)

## 1. 核心理念变更 (Core Shift)

| 维度 | V2.0 (旧版 - 已废弃) | **V2.1 (新版 - 当前标准)** |
| --- | --- | --- |
| **评分逻辑** | **硬门槛 (Hard Thresholds)**。<br>

<br> 缺主键/缺时间戳 = 0分/不合格。 | **场景化加权 (Context-Aware Weighted Scoring)**。<br>

<br> 先识别表的场景（如ODS/DWD/DIM），再应用对应的评分模板。 |
| **对待缺陷** | **一票否决**。<br>

<br> 视为“错误资产”。 | **提供修复路径 (Fixable Paths)**。<br>

<br> 视为“待优化资产”，明确告知如何提高分数。 |
| **适用范围** | 偏向理想化的 OLTP 数据库表。 | **完全适配 OLAP 数仓**。<br>

<br> 兼容宽表、日志表、快照表等无主键场景。 |

---

## 2. 重构后的核心流程 (Revised Workflow)

引入“场景识别”和“策略匹配”环节。

```mermaid
graph TD
    A[开始: 扫描物理表] --> B{AI: 场景与分层识别};
    B -->|判断为: DIM维表| C1[应用策略A: 强主键约束模板];
    B -->|判断为: DWD事实表| C2[应用策略B: 强时间分区模板];
    B -->|判断为: DWS汇总宽表| C3[应用策略C: 强语义注释模板];
    C1 --> D[AI: 计算初步得分与诊断];
    C2 --> D;
    C3 --> D;
    D --> E[界面: 综合结论页 (图5改)];
    E --> F[人工: 复核场景与评分];
    F --> G[界面: 治理详情页 (图7改)];
    G -->|用户依据建议修复元数据| H[重新打分];

```

---

## 3. UI/UX 详细调整规范

基于新的流程，我们需要对之前的 **图5 (结论页)** 和 **图7 (详情页)** 进行关键性改造。

### 3.1. 改造页面一：综合语义结论页 (The Decision Page)

**目标：** 让用户一眼看出 AI 是基于什么“场景”给出这个分数的，而不是莫名其妙的 0 分。

**之前的核心问题：** 因为没主键直接判 0.00 分，导致用户认为 AI 不智能。

**V2.1 调整规范：**

1. **新增“场景/策略”标识：**
* 在“表维度得分”旁边，显著展示当前应用的评分策略。
* *样式示例：* `表维度得分: 0.65 (良)` | `已应用策略: [DWS汇总表评分标准]`


2. **证据仪表盘的动态解释：**
* 仪表盘的三个卡片（生命周期、质量、安全）保持不变，但 AI 给出的“判断依据”文案需要根据场景变化。
* *场景 A (DIM表) 的依据：* “检测到唯一主键，符合维表特征。”
* *场景 B (日志表) 的依据：* “未检测到主键，但存在时间分区字段，符合日志表特征。”（**注意：这里不再提示为缺陷**）



### 3.2. 改造页面二：语义理解引擎详情页 (The Diagnosis Page) —— **核心改动**

**目标：** 废弃“硬门槛警告条”，转变为提供“可修复路径”的诊断面板。

**之前的核心问题：** 黄色的警告条列出“未通过项：是否存在主键字段”，这对于数仓宽表来说是错误的指引。

**V2.1 调整规范：**

1. **彻底移除“未通过项”警告条。**
2. **新增模块：“评分透视与优化建议 (Scoring Breakdown & Fix Paths)”**
* 位于头部评分卡下方，替代原来的警告条位置。
* 这是一个表格或列表，详细列出当前策略下的得分点和扣分点。



**“评分透视”面板设计示例 (以一张 DWS 宽表为例)：**

> **当前评分策略：DWS 汇总宽表标准 (重点考核语义清晰度)**
> | 考核维度 | 权重 | 得分 | 诊断结果与修复建议 (Fix Path) | 状态 |
> | --- | --- | --- | --- | --- |
> | **业务语义注释** | 50% | 30/50 | **注释覆盖率不足 (60%)**。<br>
> 
> <br> *建议：请补充 `gmv_amt`, `usr_cnt` 等关键指标字段的业务口径注释。* | ⚠️ 待修复 |
> | **生命周期/分区** | 30% | 30/30 | 检测到有效的时间分区字段 `dt`。 | ✅ 已达标 |
> | **主键/唯一性** | 20% | 10/20 | 未检测到物理主键。<br>
> 
> <br> *建议：汇总表虽不强制物理主键，但建议在元数据中标记逻辑联合主键以提升治理等级。* | ℹ️ 可优化 |
> 
> 

3. **字段列表的联动：**
* 在下方的字段列表中，对于建议修复的字段（如缺少注释的字段），可以用黄色高亮或小图标提示，引导用户直接编辑。



---

## 4. 后端与算法需求变更

为了支撑前端的改变，后端逻辑需要做相应调整。

1. **构建“评分策略集 (Policy Set)”：**
* 后端需要维护多套评分模板（JSON 配置）。
* *模板示例 (DIM表):* `{ "pk_check": { "weight": 0.6, "must_pass": true }, "comment_check": { "weight": 0.4 } }`
* *模板示例 (DWS表):* `{ "pk_check": { "weight": 0.1, "must_pass": false }, "comment_check": { "weight": 0.7 } }`


2. **AI 场景分类能力增强：**
* AI 的第一步任务不再是打分，而是分类。基于表名规范（`dim_`, `dwd_`）、字段特征、上下游依赖，判断其最可能的数仓分层和角色。


3. **API 返回结构调整：**
* 详情页接口不仅要返回总分，还要返回 `applied_policy_name` (应用的策略名) 以及详细的 `scoring_breakdown` (得分明细和建议文案)。



---

## 5. 总结

通过这次调整，我们的平台从一个刻板的“质检员”变成了一个懂业务的“数仓专家顾问”。

* 它理解对于日志表来说，没有主键不是错误。
* 它明确告诉用户，对于宽表来说，把注释写清楚比什么都重要。

这种**“可沟通、可修复、场景化”**的设计，是语义治理平台能在企业真实环境落地的关键。