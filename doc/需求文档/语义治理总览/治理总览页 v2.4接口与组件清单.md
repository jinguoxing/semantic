# 治理总览页 v2.4 接口与组件清单

用于前后端对齐数据口径与组件拆分的落地说明，基于 v2.4 方案与 KPI 口径。

---

## 1. 目标与范围

- 目标：提供“治理总览页”一页的接口契约 + 组件清单 + 数据字段说明
- 前提：当前生效语义版本（latest `PUBLISHED`）为事实源
- 默认时间范围：近 30 天（`30d`）

---

## 2. 接口契约

### 2.1 接口

`GET /api/governance/overview`

### 2.2 请求参数（Query）

```text
range=7d|30d|90d        // 默认 30d
datasourceId=...        // 可选
domainId=...            // 可选
logicalViewIds=...      // 可选（逗号分隔）
```

### 2.3 响应结构（JSON）

```json
{
  "timeRange": "30d",
  "scope": {
    "datasourceId": "ds_001",
    "domainId": "dm_01",
    "logicalViewIds": ["lv_1", "lv_2"]
  },
  "activeVersion": {
    "versionId": "v_243",
    "versionName": "v2.4.3",
    "publishedAt": "2026-01-12T10:00:00Z"
  },
  "kpis": {
    "fieldSemantic": { "coverageRate": 0.68, "covered": 680, "total": 1000 },
    "qualityGate": { "passRate": 0.82, "passTables": 82, "totalTables": 100, "blockerTables": 5 },
    "security": { "completionRate": 0.74, "done": 740, "required": 1000, "highUndone": 3 },
    "risk": { "level": "HIGH", "reasons": ["SEMANTIC_BLOCKER"] }
  },
  "pipeline": [
    { "step": "LOGICAL_VIEW", "status": "DONE", "done": 100, "total": 100, "blockers": 0, "cta": { "text": "查看逻辑视图", "link": "/logical-views" } },
    { "step": "FIELD_SEMANTIC", "status": "IN_PROGRESS", "done": 680, "total": 1000, "blockers": 2, "cta": { "text": "继续字段语义理解", "link": "/field-semantics?filter=pending" } },
    { "step": "QUALITY", "status": "IN_PROGRESS", "done": 82, "total": 100, "blockers": 5, "cta": { "text": "处理质量阻塞项", "link": "/quality?filter=gate_failed" } },
    { "step": "SECURITY", "status": "IN_PROGRESS", "done": 740, "total": 1000, "blockers": 3, "cta": { "text": "完成高敏字段分级", "link": "/security?filter=high_undone" } },
    { "step": "VERSION", "status": "DONE", "done": 1, "total": 1, "blockers": 0, "cta": { "text": "查看语义版本", "link": "/semantic-versions/v_243" } }
  ],
  "blockers": {
    "semantic": { "count": 2, "topItems": [{ "fieldId": "f1", "table": "t_order", "field": "order_status" }] },
    "quality": { "count": 5, "topItems": [{ "tableId": "t1", "table": "t_payment" }] },
    "security": { "count": 3, "topItems": [{ "fieldId": "f9", "table": "t_user", "field": "id_card_no" }] }
  },
  "distribution": {
    "tableSemantic": { "subject": 120, "event": 45, "dimension": 30, "unknown": 60 },
    "fieldRole": { "businessAttr": 0.48, "status": 0.12, "relation": 0.18, "audit": 0.22 }
  },
  "quickActions": [
    { "text": "继续字段语义理解", "count": 12, "link": "/field-semantics?filter=pending" },
    { "text": "处理质量阻塞项", "count": 5, "link": "/quality?filter=gate_failed" },
    { "text": "完成高敏字段分级", "count": 3, "link": "/security?filter=high_undone" },
    { "text": "查看当前语义版本", "link": "/semantic-versions/v_243" }
  ],
  "versionStats": {
    "fieldSemanticCoverage": 1.0,
    "qualityRuleCoverage": 0.85,
    "securityPolicyCoverage": 0.9
  }
}
```

---

## 3. 字段说明与枚举

### 3.1 时间范围

- `timeRange`: `7d | 30d | 90d`，默认 `30d`

### 3.2 KPI 指标（A 区）

- `coverageRate/passRate/completionRate`: 0~1 浮点，前端按百分比显示
- `covered/total/passTables/totalTables/done/required`: 计数
- `risk.level`: `LOW | MEDIUM | HIGH`
- `risk.reasons`: 风险来源枚举（示例：`SEMANTIC_BLOCKER | DQ_BLOCKER_TABLES | SEC_HIGH_UNDONE`）

### 3.3 主线进度（B 区）

- `pipeline.step`: `LOGICAL_VIEW | FIELD_SEMANTIC | QUALITY | SECURITY | VERSION`
- `pipeline.status`: `NOT_STARTED | IN_PROGRESS | DONE`
- `pipeline.blockers`: 阻塞数（用于高亮 bottleneck）

### 3.4 阻塞项（C 区）

- `blockers.semantic`: 关键字段未确认
- `blockers.quality`: Gate 未通过表
- `blockers.security`: 高敏字段未分级

### 3.5 分布（D 区）

- `distribution.tableSemantic`: 主体/事件/维度/未判定（数量）
- `distribution.fieldRole`: 业务属性/状态/关联/审计（占比 0~1）

---

## 4. 关键口径与规则（已确认）

### 4.1 关键字段判定（语义阻塞）

- 规则：字段角色白名单
- 口径：`role_code in { ID, PRIMARY_KEY, FOREIGN_KEY, STATUS, TIME, REQUIRED }`
- 说明：实际角色枚举以你们系统为准，以上为映射示例

### 4.2 风险等级

- 规则：任一阻塞 > 0 即 `HIGH`
- `MEDIUM`：无阻塞，但存在质量或安全 warning
- `LOW`：无阻塞且无 warning

### 4.3 表语义分布分类

- `主体 / 事件 / 维度 / 未判定`

---

## 5. 组件清单（前端拆分）

### A. KPI 总览

- `GovernanceKPICard`
  - Props: `title`, `value`, `subText`, `statusColor`, `link`

### B. 主线进度

- `PipelineStepBar`
  - Props: `steps[]`（step/status/done/total/blockers/cta）

### C. 阻塞项

- `BlockerCard`
  - Props: `title`, `items[]`, `cta`

### D. 分布

- `DistributionCard`
  - Props: `title`, `items[]`

### E. 快捷入口

- `ActionRow`
  - Props: `text`, `count?`, `link`

### F. 语义版本锚点

- `VersionHighlightCard`
  - Props: `versionName`, `publishedAt`, `versionStats`, `cta`

---

## 6. 空态与异常处理

- 无 `activeVersion`：
  - KPI 显示 `--`，主线进度为 `NOT_STARTED`
  - 版本卡提示“暂无已发布版本”
- 分母为 0：rate 返回 `0`，前端显示 `--`
- 无质量检查 run：`qualityGate.passRate = null`，pipeline 质量步骤 `NOT_STARTED`

---

## 7. 页面交互（路由建议）

- KPI 卡片点击：跳转对应治理子页并带过滤
- 阻塞卡 CTA：进入阻塞列表
- 入口动作：直接进入待处理列表
- 版本卡：进入当前版本详情

