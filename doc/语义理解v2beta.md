# 语义理解 V2 Beta - 三维度渐进式设计

> 基于 `doc/gemini/整合.md` 的元数据属性体系，结合 V2.1 压缩布局

---

## 🎯 设计目标

1. **属性分层**：按业务身份、生命周期、质量安全三维度组织
2. **渐进披露**：核心属性首屏展示，次要属性折叠隐藏
3. **减少负担**：AI预填 + 系统推断，用户只需确认/修改

---

## 📐 表级三维度属性

### 维度划分

| 维度 | 属性 | 优先级 | 展示方式 |
|------|------|--------|---------|
| **🏷️ 业务身份维** | 业务名称、归属域、对象分类、数据粒度 | ★★★ | 始终展开 |
| **⏱️ 生命周期维** | 数据层级、更新策略、存储周期 | ★★ | 默认折叠 |
| **🛡️ 质量安全维** | 数据负责人、安全等级 | ★ | 默认折叠 |

### 对象分类 (5类)

```
┌──────────┬────────────────────────────────────────┐
│ 对象类型 │ 说明                                   │
├──────────┼────────────────────────────────────────┤
│ 主体     │ 核心业务实体 (用户、订单、商品)        │
│ 行为     │ 业务动作记录 (登录、支付、签到)        │
│ 状态     │ 状态快照 (订单状态、审批流程)          │
│ 规则     │ 业务规则配置 (字典、枚举、策略)        │
│ 属性     │ 派生/汇总数据 (标签、指标、宽表)       │
└──────────┴────────────────────────────────────────┘
```

---

## 🎨 UI 布局设计

### 完整结构

```
┌───────────────────────────────────────────────────────────────────┐
│ ✨ 语义理解引擎                                                   │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│  📊 表维度: 0.75 (4/4通过)  │  🔤 字段维度: 0.85 (3/3通过) [▶展开]│
│                                                                   │
├───────────────────────────────────────────────────────────────────┤
│  深入分析  [字段结构(12)] [关系图谱(3)] [质量概览]               │
│  ├──────────────────────────────────────────────────────────────  │
│  │  字段名      类型          语义角色    敏感等级   质量         │
│  │  order_id    varchar(32)   标识符      L1         A           │
│  │  ...                                                          │
│  └──────────────────────────────────────────────────────────────  │
│                                                                   │
├───────────────────────────────────────────────────────────────────┤
│ 🎯 综合语义结论                                  置信度: 0.89     │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                                   │
│ ┌─ 🏷️ 业务身份 ──────────────────────────────────────────────────┐│
│ │                                                                ││
│ │  业务名称   [订单主表        ]   归属业务域  [交易域 ▼]        ││
│ │                                                                ││
│ │  对象类型   ● 主体  ○ 行为  ○ 状态  ○ 规则  ○ 属性            ││
│ │                                                                ││
│ │  数据粒度   [单笔订单                                   ]      ││
│ │                                                                ││
│ └────────────────────────────────────────────────────────────────┘│
│                                                                   │
│  [⏱️ 生命周期 ▶]  [🛡️ 质量安全 ▶]                                │
│                                                                   │
│  业务描述:                                                        │
│  [核心业务实体，记录订单交易流水信息，包含订单基础属性...]       │
│                                                                   │
│  理解依据:  [表名对应概念] [有效主键] [实体模式]                  │
│                                                                   │
│                  [忽略]  [修正结果]  [✓ 确认并生成逻辑实体]       │
└───────────────────────────────────────────────────────────────────┘
```

### 折叠区展开效果

点击 `[⏱️ 生命周期 ▶]` 后：

```
  ▼ ⏱️ 生命周期                       ▼ 🛡️ 质量安全
  ┌──────────────────────────┐        ┌──────────────────────────┐
  │ 数据层级    [DWD ▼]      │        │ 安全等级    [L2-内部 ▼]  │
  │   ○ ODS  ● DWD  ○ DWS   │        │   ○ L1-公开  ● L2-内部   │
  │   ○ ADS  ○ 其他         │        │   ○ L3-机密  ○ L4-绝密   │
  │                          │        │                          │
  │ 更新策略    [增量追加 ▼] │        │ 数据负责人  [选择... ▼]  │
  │ 存储周期    [永久 ▼]     │        │                          │
  └──────────────────────────┘        └──────────────────────────┘
```

---

## 🔧 输入控件设计

| 属性 | 控件类型 | 数据来源 | 用户操作 |
|------|---------|---------|---------|
| 业务名称 | 文本框 | AI生成 | 编辑确认 |
| 归属域 | 下拉选择 | 预设枚举 | 选择 |
| 对象类型 | Radio按钮组 | AI推断 | 单选确认 |
| 数据粒度 | 文本框 | AI生成 | 编辑确认 |
| 数据层级 | Radio按钮组 | 系统推断 | 单选确认 |
| 更新策略 | 下拉选择 | 系统推断 | 选择 |
| 存储周期 | 下拉选择 | 默认"永久" | 选择 |
| 安全等级 | Radio按钮组 | 字段敏感度推断 | 单选确认 |
| 数据负责人 | 下拉选择 | 无默认 | 选择 |

---

## 📊 视觉规范

### 颜色分区

| 维度 | 背景色 | 边框色 | 图标 |
|------|--------|--------|------|
| 业务身份 | `bg-blue-50/50` | `border-blue-100` | 🏷️ |
| 生命周期 | `bg-amber-50/50` | `border-amber-100` | ⏱️ |
| 质量安全 | `bg-emerald-50/50` | `border-emerald-100` | 🛡️ |

### 折叠按钮样式

```tsx
// 折叠态
<button className="flex items-center gap-2 px-3 py-1.5 text-sm text-slate-500 hover:bg-slate-100 rounded-lg">
  <span>⏱️</span> 生命周期 <ChevronRight size={14} />
</button>

// 展开态
<button className="flex items-center gap-2 px-3 py-1.5 text-sm text-amber-700 bg-amber-50 rounded-lg">
  <span>⏱️</span> 生命周期 <ChevronDown size={14} />
</button>
```

---

## 🔄 数据流设计

### AI 推断规则

| 属性 | 推断逻辑 |
|------|---------|
| **对象类型** | 表名含 `log/history/flow` → 行为；含 `dict/config` → 规则；含 `_base/_info` → 主体 |
| **数据层级** | 表名含 `ods_` → ODS；含 `dwd_` → DWD；含 `dws_` → DWS |
| **安全等级** | 存在 L3/L4 敏感字段 → L3；否则 → L2 |

### 表单数据结构

```typescript
interface TableSemanticProfileV2 extends TableSemanticProfile {
  // 业务身份维
  businessDomain?: string;        // 归属域
  objectType?: 'entity' | 'event' | 'state' | 'rule' | 'attribute';
  dataGrain?: string;             // 数据粒度描述
  
  // 生命周期维
  dataLayer?: 'ODS' | 'DWD' | 'DWS' | 'ADS' | 'OTHER';
  updateStrategy?: 'append' | 'overwrite' | 'scd';
  retentionPeriod?: string;
  
  // 质量安全维
  securityLevel?: 'L1' | 'L2' | 'L3' | 'L4';
  dataOwner?: string;
}
```

---

## ✅ 实施计划

### Phase 1: 业务身份维 (本次)
- [ ] 增加对象类型 Radio 选择
- [ ] 增加归属域下拉选择
- [ ] 增加数据粒度文本框
- [ ] AI推断逻辑

### Phase 2: 生命周期维
- [ ] 增加折叠面板组件
- [ ] 数据层级/更新策略/存储周期控件

### Phase 3: 质量安全维
- [ ] 安全等级选择
- [ ] 数据负责人选择（需后端 API）

### Phase 4: 字段六维度
- [ ] 字段详情面板组件
- [ ] 智能分类逻辑
- [ ] 各维度表单

---

## 📈 预期效果

| 指标 | 当前 | V2 Beta |
|------|------|---------|
| 表级属性数 | 2 (名称+描述) | 9 (3维度) |
| 字段属性数 | 3 (角色+敏感+质量) | 3-12 (6维度按需) |
| 首屏空间占用 | ~200px | ~280px (+40%) |
| 信息完整度 | 30% | 80% |

---

# 第二部分：字段级六维度设计

## 📊 字段级六维度属性

### 维度划分

| 维度 | 属性 | 适用字段类型 |
|------|------|-------------|
| **🏷️ 核心语义** | 业务术语、业务口径、主键标识 | 所有字段 |
| **📊 值域度量** | 逻辑类型、单位、枚举引用、空值含义 | 数值/枚举字段 |
| **⏱️ 时间语义** | 时间角色、时区 | 时间类字段 |
| **🔗 关系维** | 外键关联、依赖字段 | ID/外键字段 |
| **📐 计算逻辑** | 派生标记、计算公式、来源映射 | 派生字段 |
| **🔒 安全隐私** | 敏感标签、脱敏规则 | 敏感字段 |

---

## 🎯 智能分类规则

根据字段角色自动决定显示哪些维度：

| 字段角色 | 图标 | 显示维度 |
|---------|------|---------|
| **主键/标识符** | 🔑 | 核心语义 |
| **外键** | 🔗 | 核心语义 + 关系维 |
| **度量 (数值)** | 📊 | 核心语义 + 值域度量 |
| **枚举** | 📋 | 核心语义 + 值域度量(枚举) |
| **时间** | ⏱️ | 核心语义 + 时间语义 |
| **敏感字段** | 🔒 | 核心语义 + 安全隐私 |
| **派生字段** | 📐 | 核心语义 + 计算逻辑 |
| **普通业务** | 📝 | 核心语义 |

---

## 🎨 字段列表视图

### 精简表格 (默认)

```
┌─────────────────────────────────────────────────────────────────┐
│ 深入分析  [字段结构(12)] [关系图谱] [质量概览]                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 字段名       类型        角色       敏感   待补全        操作   │
│ ─────────────────────────────────────────────────────────────── │
│ order_id     varchar     🔑 标识符  L1     ✓ 完整        [>]   │
│ user_id      bigint      🔗 外键    L2     ⚠ 外键关联    [>]   │
│ amount       decimal     📊 度量    L1     ⚠ 单位        [>]   │
│ status       tinyint     📋 枚举    L1     ⚠ 字典引用    [>]   │
│ create_time  datetime    ⏱️ 时间    L1     ✓ 完整        [>]   │
│ id_card      varchar     🔒 敏感    L4     ⚠ 脱敏规则    [>]   │
│                                                                 │
│ 📊 统计: 6 个字段, 4 个待补全                                   │
└─────────────────────────────────────────────────────────────────┘
```

### 待补全提示规则

| 字段角色 | 待补全项 | 提示文案 |
|---------|---------|---------|
| 外键 | 未关联目标表 | `⚠ 外键关联` |
| 度量 | 未填单位 | `⚠ 单位` |
| 枚举 | 未关联字典 | `⚠ 字典引用` |
| 敏感 | 未设脱敏规则 | `⚠ 脱敏规则` |
| 派生 | 未填计算公式 | `⚠ 计算逻辑` |

---

## 📝 字段详情面板

点击 `[>]` 展开该字段的语义详情面板（根据角色动态渲染）

### 通用结构

```
┌─────────────────────────────────────────────────────────────────┐
│ 📝 {字段名} ({业务术语})                          [保存] [取消] │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 🏷️ 核心语义 (始终显示)                                         │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 业务术语  [{AI生成的术语}        ]                          │ │
│ │ 业务口径  [{AI生成的解释...}                            ]   │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ {根据角色动态显示其他维度}                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 外键字段详情

```
┌─ user_id ─────────────────────────────────────────┐
│                                                   │
│ 🏷️ 核心语义                                      │
│ ├─ 业务术语  [用户ID      ]                       │
│ └─ 业务口径  [关联用户表主键]                     │
│                                                   │
│ 🔗 关系维                                         │
│ ├─ 关联表    [t_user ▼]                          │
│ ├─ 关联字段  [id ▼]                              │
│ └─ 关系类型  [多对一 ▼]                          │
│                                                   │
│                              [保存] [取消]        │
└───────────────────────────────────────────────────┘
```

### 度量字段详情

```
┌─ amount ──────────────────────────────────────────┐
│                                                   │
│ 🏷️ 核心语义                                      │
│ ├─ 业务术语  [订单金额    ]                       │
│ └─ 业务口径  [订单实付金额，不含优惠]             │
│                                                   │
│ 📊 值域度量                                       │
│ ├─ 逻辑类型  [金额 ▼]                            │
│ ├─ 计量单位  [元 ▼]                              │
│ └─ 空值含义  [表示0元 ▼]                         │
│                                                   │
│                              [保存] [取消]        │
└───────────────────────────────────────────────────┘
```

### 枚举字段详情

```
┌─ status ──────────────────────────────────────────┐
│                                                   │
│ 🏷️ 核心语义                                      │
│ ├─ 业务术语  [订单状态    ]                       │
│ └─ 业务口径  [订单当前流转状态]                   │
│                                                   │
│ 📊 值域度量                                       │
│ ├─ 关联字典  [dict_order_status ▼]               │
│ └─ 枚举值预览:                                    │
│    ┌────────┬────────────┐                        │
│    │ 0      │ 待支付     │                        │
│    │ 1      │ 已支付     │                        │
│    │ 2      │ 已取消     │                        │
│    └────────┴────────────┘                        │
│                                                   │
│                              [保存] [取消]        │
└───────────────────────────────────────────────────┘
```

### 时间字段详情

```
┌─ create_time ─────────────────────────────────────┐
│                                                   │
│ 🏷️ 核心语义                                      │
│ ├─ 业务术语  [创建时间    ]                       │
│ └─ 业务口径  [记录创建的时间戳]                   │
│                                                   │
│ ⏱️ 时间语义                                       │
│ ├─ 时间角色  ● 发生时间  ○ 处理时间  ○ 生效时间  │
│ └─ 存储时区  [UTC+8 ▼]                           │
│                                                   │
│                              [保存] [取消]        │
└───────────────────────────────────────────────────┘
```

### 敏感字段详情

```
┌─ id_card ─────────────────────────────────────────┐
│                                                   │
│ 🏷️ 核心语义                                      │
│ ├─ 业务术语  [身份证号    ]                       │
│ └─ 业务口径  [用户18位身份证号码]                 │
│                                                   │
│ 🔒 安全隐私                                       │
│ ├─ 敏感类型  [身份证 ▼]                          │
│ ├─ 敏感等级  ○ L2  ○ L3  ● L4                   │
│ └─ 脱敏规则  [保留前6后4，中间打星 ▼]            │
│    预览: 110101****1234                           │
│                                                   │
│                              [保存] [取消]        │
└───────────────────────────────────────────────────┘
```

---

## 🔧 字段维度控件设计

| 维度 | 属性 | 控件类型 | 选项/说明 |
|------|------|---------|----------|
| **核心语义** | 业务术语 | 文本框 | AI预填 |
| | 业务口径 | 多行文本 | AI预填 |
| **值域度量** | 逻辑类型 | 下拉 | 金额/数量/比率/枚举/手机号/身份证/URL... |
| | 计量单位 | 下拉 | 元/万元/个/次/秒/百分比... |
| | 枚举引用 | 下拉 | 系统字典列表 |
| | 空值含义 | 下拉 | 无数据/表示0/无限大/未知 |
| **时间语义** | 时间角色 | Radio | 发生时间/处理时间/生效时间/失效时间 |
| | 时区 | 下拉 | UTC/UTC+8/本地时区 |
| **关系维** | 关联表 | 下拉 | 当前数据源表列表 |
| | 关联字段 | 下拉 | 联动选中表的字段 |
| | 关系类型 | 下拉 | 多对一/一对多/一对一 |
| **计算逻辑** | 派生标记 | 开关 | 是/否 |
| | 计算公式 | 文本框 | 如: `price * qty` |
| | 来源映射 | 文本框 | 如: `ods_order.amount` |
| **安全隐私** | 敏感类型 | 下拉 | 手机号/身份证/银行卡/地址/姓名... |
| | 脱敏规则 | 下拉 | 全脱敏/保留前N后M/哈希... |

---

## 🔄 字段数据结构

```typescript
interface FieldSemanticProfileV2 extends FieldSemanticProfile {
  // 核心语义 (所有字段)
  businessTerm?: string;           // 业务术语
  businessDefinition?: string;     // 业务口径
  
  // 值域度量 (数值/枚举字段)
  logicalType?: string;            // 逻辑数据类型
  unit?: string;                   // 计量单位
  dictRef?: string;                // 枚举引用
  nullMeaning?: string;            // 空值含义
  
  // 时间语义 (时间字段)
  timeRole?: 'event' | 'process' | 'effective' | 'expire';
  timeZone?: string;
  
  // 关系维 (外键字段)
  fkTargetTable?: string;          // 关联表
  fkTargetField?: string;          // 关联字段
  fkRelationType?: 'many-to-one' | 'one-to-many' | 'one-to-one';
  
  // 计算逻辑 (派生字段)
  isDerived?: boolean;
  formula?: string;
  sourceMapping?: string;
  
  // 安全隐私 (敏感字段)
  sensitiveType?: string;          // 敏感类型
  maskingRule?: string;            // 脱敏规则
}
```

---

## ✅ 方案优势

| 特点 | 说明 |
|------|------|
| **智能筛选** | 根据字段角色只显示相关维度，减少信息过载 |
| **待补全提示** | 列表直接标注缺少什么，一目了然 |
| **按需编辑** | 点击展开才显示详细表单，精简首屏 |
| **AI预填** | 业务术语/口径由AI生成，减少手工输入 |
| **批量识别** | 时间/外键/枚举/敏感字段自动分类 |

---

# 第三部分：LLM 增强层设计

> 基于 `doc/gemini/llm-语义理解.md`，将 LLM 作为"超级助手 (Co-pilot)"集成到语义治理流程

---

## 🤖 LLM 增强目标

| 目标 | 说明 |
|------|------|
| **从填空变选择** | 用户只需确认/修改 AI 预填结果 |
| **智能语义推断** | 综合表名+字段+注释分析，比规则更准确 |
| **减少手工输入** | 自动生成业务名称、粒度描述、字段口径 |

---

## 🔄 LLM 增强流程

```
┌─────────────────────────────────────────────────────────────────┐
│                        语义理解流程                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. 物理扫描          2. 规则分析          3. LLM 增强          │
│  ┌─────────┐         ┌─────────┐         ┌─────────┐           │
│  │ Schema  │ ───────▶│ T-01~04 │ ───────▶│  GPT/   │           │
│  │ 采集    │         │ D-01~04 │         │ Claude  │           │
│  └─────────┘         └─────────┘         └─────────┘           │
│       │                   │                   │                 │
│       ▼                   ▼                   ▼                 │
│  ┌─────────┐         ┌─────────┐         ┌─────────┐           │
│  │表结构   │         │规则得分 │         │语义预填 │           │
│  │字段列表 │         │门控结果 │         │智能推断 │           │
│  └─────────┘         └─────────┘         └─────────┘           │
│                                                 │               │
│                                                 ▼               │
│                      ┌─────────────────────────────────────┐   │
│                      │  AI 预填结果 (用户只需确认/修改)    │   │
│                      │  ├─ 对象类型: 主体 (置信85%) 🤖     │   │
│                      │  ├─ 业务名称: 订单主表 🤖           │   │
│                      │  ├─ 数据粒度: 单笔订单 🤖           │   │
│                      │  └─ 字段语义: 自动补全 🤖           │   │
│                      └─────────────────────────────────────┘   │
│                                                 │               │
│                                                 ▼               │
│  4. 人工确认                                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  [✓ 确认全部] [逐项修改] [重新分析]                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📊 LLM 预填增强对比

| 属性 | 规则预填 | LLM 增强预填 |
|------|---------|-------------|
| **对象类型** | 表名匹配 (log→行为) | 综合表名+字段+注释分析 |
| **业务名称** | 下划线转中文 | 理解业务含义生成名称 |
| **数据粒度** | ❌ 无 | ✅ "一行数据代表单笔订单" |
| **业务描述** | 模板句子 | 理解表含义生成描述 |
| **字段术语** | 字典匹配 | 上下文理解生成术语 |
| **字段口径** | ❌ 无 | ✅ 解释字段业务含义 |
| **单位推断** | ❌ 无 | ✅ "amount应该是元" |
| **枚举推断** | ❌ 无 | ✅ 识别状态字段 |

---

## 🔧 Prompt 设计

### 表级语义理解 Prompt

```typescript
const tableSemanticPrompt = `
你是数据治理专家。请分析以下表结构，按照规范输出语义信息：

【表信息】
表名: ${tableName}
注释: ${tableComment || '无'}
字段列表: ${fields.map(f => \`\${f.name}(\${f.type})\`).join(', ')}

【输出要求】(JSON格式)
{
  "objectType": "entity|event|state|rule|attribute",
  "objectTypeReason": "判断依据",
  "businessName": "中文业务名称",
  "dataGrain": "一行数据代表什么",
  "description": "业务描述(50字内)",
  "confidence": 0.0-1.0
}

【分类标准】
- entity(主体): 核心业务实体，如用户、订单、商品
- event(行为): 业务动作记录，如登录、支付、点击
- state(状态): 状态快照，如审批状态、流程节点
- rule(规则): 业务规则配置，如字典、枚举
- attribute(属性): 派生/汇总数据，如标签、指标
`;
```

### 字段语义理解 Prompt

```typescript
const fieldSemanticPrompt = `
你是数据治理专家。请分析以下字段，生成语义信息：

【字段信息】
字段名: ${fieldName}
类型: ${fieldType}
所属表: ${tableName} (${tableBusinessName})
上下文字段: ${contextFields.join(', ')}

【输出要求】(JSON格式)
{
  "businessTerm": "中文业务术语",
  "businessDefinition": "业务口径(一句话解释)",
  "logicalType": "金额|数量|枚举|标识符|时间|手机号|身份证|URL|普通文本",
  "unit": "元|个|次|秒|null",
  "nullMeaning": "无数据|表示0|未知"
}
`;
```

### 批量字段分析 Prompt

```typescript
const batchFieldPrompt = `
你是数据治理专家。请批量分析以下字段，为每个字段生成语义信息：

【表信息】
表名: ${tableName}
业务名称: ${businessName}

【字段列表】
${fields.map(f => \`- \${f.name} (\${f.type})\`).join('\\n')}

【输出要求】(JSON数组)
[
  {
    "fieldName": "字段名",
    "businessTerm": "业务术语",
    "businessDefinition": "业务口径",
    "logicalType": "逻辑类型",
    "unit": "单位或null",
    "role": "Identifier|ForeignKey|Measure|Enum|Time|Sensitive|Derived|BusAttr"
  },
  ...
]
`;
```

---

## 🎨 UI 交互优化

### AI 预填标记

```
┌─ 🏷️ 业务身份 ─────────────────────────────────────────────────┐
│                                                                │
│  业务名称   [订单主表        ] 🤖                              │
│                                                                │
│  对象类型   ● 主体  ○ 行为  ○ 状态  ○ 规则  ○ 属性            │
│             💡 AI: 含order_id主键和lifecycle字段，判断为主体   │
│                                                                │
│  数据粒度   [单笔订单                    ] 🤖                   │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### 字段列表 AI 标记

```
│ 字段名       类型        角色       业务术语      AI状态  操作 │
│ ─────────────────────────────────────────────────────────────── │
│ order_id     varchar     🔑 标识符  订单编号 🤖   ✓       [>] │
│ amount       decimal     📊 度量    订单金额 🤖   ⚠单位   [>] │
│ status       tinyint     📋 枚举    订单状态 🤖   ⚠字典   [>] │
```

---

## 🏗️ Agent 架构

```
┌─────────────────────────────────────────────────────────────────┐
│                   Data Governance Agent                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. Context (上下文注入)                                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ System Prompt:                                          │   │
│  │ - 5类对象分类标准                                        │   │
│  │ - 6维度语义规范                                          │   │
│  │ - 输出JSON格式要求                                       │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                  │
│                              ▼                                  │
│  2. RAG (检索增强)                                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 检索已有元数据:                                          │   │
│  │ - 同类表的语义定义                                       │   │
│  │ - 字典表 (枚举引用)                                      │   │
│  │ - 已定义的业务术语                                       │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                  │
│                              ▼                                  │
│  3. Inference (LLM推理)                                         │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ GPT-4 / Claude / 通义千问                                │   │
│  │ 输入: 表结构 + 上下文 + 规范                             │   │
│  │ 输出: 语义预填JSON                                       │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                  │
│                              ▼                                  │
│  4. Action (用户确认)                                           │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 用户点击确认 → 写入元数据库                              │   │
│  │ 用户点击修改 → 编辑后保存                                │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## ⚙️ LLM 服务接口

```typescript
interface LLMSemanticService {
  // 表级语义分析
  analyzeTable(input: {
    tableName: string;
    tableComment?: string;
    fields: { name: string; type: string; comment?: string }[];
  }): Promise<{
    objectType: 'entity' | 'event' | 'state' | 'rule' | 'attribute';
    objectTypeReason: string;
    businessName: string;
    dataGrain: string;
    description: string;
    confidence: number;
  }>;

  // 字段批量语义分析
  analyzeFields(input: {
    tableName: string;
    tableBusinessName: string;
    fields: { name: string; type: string }[];
  }): Promise<{
    fieldName: string;
    businessTerm: string;
    businessDefinition: string;
    logicalType: string;
    unit?: string;
    role: string;
  }[]>;
}
```

---

## ✅ 实施计划更新

### Phase 5: LLM 增强层
- [ ] LLM 服务接口设计
- [ ] 表级 Prompt 模板
- [ ] 字段级 Prompt 模板
- [ ] UI AI预填标记
- [ ] Agent 架构实现

---

## 📈 预期效果

| 指标 | 规则模式 | LLM 增强模式 |
|------|---------|-------------|
| 对象类型准确率 | ~60% (规则匹配) | ~90% (语义理解) |
| 业务名称质量 | 低 (机械转换) | 高 (语义生成) |
| 数据粒度 | ❌ 无 | ✅ 自动生成 |
| 字段口径 | ❌ 无 | ✅ 自动生成 |
| 用户操作 | 大量手工填写 | 确认/修改即可 |
| 治理效率 | 10分钟/表 | 1分钟/表 |
