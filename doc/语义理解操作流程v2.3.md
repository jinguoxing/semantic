# 语义理解操作流程 v2.3

本流程用于描述「逻辑视图（BU-03）」下的语义理解操作闭环，覆盖单表与批量两条路径，强调“规则门控 + AI 语义理解 + 人工确认”的 v2.3 原则。

---

## 1. 入口与前置条件

- 入口：左侧导航「逻辑视图 (BU-03)」
- 前置数据：已完成元数据扫描，表已进入 `scanned` 状态
- 列表支持：数据源树、表名/注释/业务名检索、批量选择

---

## 2. 单表语义理解流程（主路径）

### Step 1. 进入详情页
- 从「逻辑视图列表」点击目标表
- 若已有 `semanticAnalysis`：直接加载并进入可编辑状态
- 若未分析：进入待理解状态

### Step 2. 触发语义理解
- 点击「开始语义理解」
- 进入语义理解进度面板（模拟流）

### Step 3. 规则门控（Gatekeeper）
- T-04 表类型排除：日志/临时/关联/明细等
- T-02 主键检查：存在主键字段（如 `id` 或 `*_id`）
- T-03 生命周期字段：存在 `create_time` / `update_time` 等
- 输出：`PASS / REVIEW / REJECT` + 原因

### Step 4. 字段级语义识别
- D-01 语义角色识别（Identifier / BusAttr / ForeignKey / Status / EventHint / Audit）
- D-04 敏感级别识别（L1-L4）
- 生成字段置信度与规则命中

### Step 5. 表级规则评分
- T-01 命名合理性
- T-05 行为字段密度
- T-06 注释质量
- 输出：规则评分与证据

### Step 6. AI 语义理解（推断维度）
- 对象类型（entity / event / state / rule / attribute）
- 业务域（交易域 / 用户域 / 商品域 …）
- 数据粒度（明细 / 汇总 / 快照）
- 业务名称与描述
- AI 证据与标签

### Step 7. 融合评分
- 规则评分 + 字段评分 + AI 评分融合
- 输出最终置信度分数

### Step 8. 语义画像生成
- 生成 `TableSemanticProfile`
- 包含：业务名/描述/标签/对象类型/业务域/粒度/安全等级/字段画像

### Step 9. 人工确认
- 审核语义画像与字段语义
- 可调整对象类型、业务名、字段角色等
- 点击「保存语义分析结果」写入元数据

---

## 3. 批量语义理解流程（并行路径）

### Step 1. 批量选择
- 在逻辑视图列表中勾选多张表
- 点击「批量语义理解」

### Step 2. 批量分析
- 批量执行 AI 语义理解（模拟）
- 输出每表置信度评分

### Step 3. 结果分流
- 低置信度表：进入 `pending_review`，弹出复核列表
- 高置信度表：自动生成语义画像（待人工确认）

### Step 4. 复核确认
- 用户逐条确认或修改
- 确认后写入元数据

---

## 4. 结果与状态流转

- `scanned`：完成元数据扫描
- `pending_review`：语义理解完成但需复核
- `analyzed`：人工确认后生效
- `ignored`：用户忽略该表

---

## 5. 约束与原则（BizSemantic v2.3）

- 规则定义“硬边界”，AI 负责语义理解，最终由人工确认
- 语义理解结果为“建议”，不可自动生效
- 语义画像必须可解释、可追溯

---

## 6. 输出产物清单

- 表级语义画像（TableSemanticProfile）
- 字段级语义画像（FieldSemanticProfile）
- 规则证据与 AI 证据
- 置信度评分与解释
- 审核状态与确认记录

